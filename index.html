<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker CoopAchat</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5e6f5 0%, #e8f2f7 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(220, 200, 220, 0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e8b4d0;
        }

        .header h1 {
            color: #e8b4d0;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #e8b4d0 0%, #d5a0bc 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            text-align: center;
            box-shadow: 0 5px 15px rgba(232, 180, 208, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .label {
            font-size: 1em;
            opacity: 0.9;
        }

        .progress-bar-container {
            background: #f0f0f0;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #e8b4d0 0%, #d5a0bc 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .features-section {
            margin-top: 30px;
        }

        .module {
            background: #faf5f8;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #e8b4d0;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: white;
            border-radius: 10px;
        }

        .module-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #e8b4d0;
        }

        .module-stats {
            font-size: 0.9em;
            color: #666;
        }

        .features-list {
            display: grid;
            gap: 10px;
        }

        .feature-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: 40px 120px 1fr 100px 80px;
            gap: 15px;
            align-items: center;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .feature-item:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left-color: #e8b4d0;
        }

        .feature-item.completed {
            background: #f0f8f0;
            border-left-color: #a8d5a8;
        }

        .feature-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .feature-id {
            font-weight: bold;
            color: #666;
            font-size: 0.85em;
        }

        .feature-name {
            font-weight: 600;
            color: #333;
        }

        .feature-priority {
            text-align: center;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .priority-critical {
            background: #e8b4b4;
            color: white;
        }

        .priority-important {
            background: #f0d890;
            color: #333;
        }

        .priority-normal {
            background: #a8d5a8;
            color: white;
        }

        .feature-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #a8c8e0;
            color: white;
        }

        .btn-delete {
            background: #d4b8a8;
            color: white;
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .add-feature-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #a8d5a8 0%, #90c090 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .add-feature-btn:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5em;
            color: #e8b4d0;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #f0f0f0;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e8b4d0 0%, #d5a0bc 100%);
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .history {
            margin-top: 30px;
            padding: 20px;
            background: #faf5f8;
            border-radius: 10px;
            border: 2px solid #e8b4d0;
        }

        .history h3 {
            color: #e8b4d0;
            margin-bottom: 15px;
        }

        .history-item {
            padding: 10px;
            background: white;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(232, 180, 208, 0.2);
        }

        .collapsed .features-list {
            display: none;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 10px;
            background: #a8d5a8;
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .status-indicator.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .feature-item {
                grid-template-columns: 40px 1fr;
                gap: 10px;
            }
            
            .feature-id,
            .feature-priority,
            .feature-actions {
                grid-column: 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Tracker CoopAchat</h1>
            <p>Suivez votre progression sur les 138 fonctionnalit√©s</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="completed">0</div>
                <div class="label">Termin√©es</div>
            </div>
            <div class="stat-card">
                <div class="number" id="remaining">138</div>
                <div class="label">Restantes</div>
            </div>
            <div class="stat-card">
                <div class="number" id="percentage">0%</div>
                <div class="label">Progression</div>
            </div>
            <div class="stat-card">
                <div class="number" id="days-left">--</div>
                <div class="label">Jours estim√©s</div>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
        </div>

        <div class="chart-container">
            <canvas id="progressChart"></canvas>
        </div>

        <div class="features-section">
            <button class="add-feature-btn" onclick="openAddModal()">+ Ajouter une fonctionnalit√©</button>
            <div id="modulesList"></div>
        </div>

        <div class="history">
            <h3>üìú Historique des modifications</h3>
            <div id="historyList"></div>
        </div>
    </div>

    <div class="status-indicator" id="statusIndicator"></div>

    <!-- Modal Ajout/Modification -->
    <div id="featureModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">Ajouter une fonctionnalit√©</div>
            <form id="featureForm">
                <div class="form-group">
                    <label>Module</label>
                    <select id="featureModule" required>
                        <option value="AUTHENTIFICATION">üîê Authentification</option>
                        <option value="SALARI√â">üë§ Salari√©</option>
                        <option value="COMMERCIAL">üíº Commercial</option>
                        <option value="LOGISTIQUE">üì¶ Responsable Logistique</option>
                        <option value="LIVREUR">üöö Livreur</option>
                        <option value="ADMINISTRATEUR">‚öôÔ∏è Administrateur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ID</label>
                    <input type="text" id="featureId" placeholder="AUTH-01" required>
                </div>
                <div class="form-group">
                    <label>Nom</label>
                    <input type="text" id="featureName" placeholder="Inscription - Salari√©" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="featureDescription" placeholder="Description d√©taill√©e..."></textarea>
                </div>
                <div class="form-group">
                    <label>Priorit√©</label>
                    <select id="featurePriority" required>
                        <option value="critical">üî¥ Critique</option>
                        <option value="important">üü° Important</option>
                        <option value="normal">üü¢ Normal</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const DEFAULT_FEATURES = {
            "AUTHENTIFICATION": [
                {id: "AUTH-01", name: "Inscription - Salari√©", description: "Cr√©er un compte avec email, t√©l√©phone, mot de passe, entreprise", priority: "critical"},
                {id: "AUTH-02", name: "Inscription - Commercial", description: "Cr√©er un compte commercial avec informations entreprise", priority: "critical"},
                {id: "AUTH-03", name: "Inscription - Responsable Logistique", description: "Cr√©er un compte pour g√©rer les stocks et livraisons", priority: "critical"},
                {id: "AUTH-04", name: "Inscription - Livreur", description: "Cr√©er un compte livreur pour acc√©der aux tourn√©es", priority: "critical"},
                {id: "AUTH-05", name: "Inscription - Administrateur", description: "Cr√©er un compte admin avec acc√®s complet", priority: "critical"},
                {id: "AUTH-06", name: "V√©rification email", description: "V√©rifier l'email avec code √† 6 chiffres (OTP)", priority: "critical"},
                {id: "AUTH-07", name: "Connexion", description: "Se connecter avec email/t√©l√©phone + mot de passe", priority: "critical"},
                {id: "AUTH-08", name: "Mot de passe oubli√©", description: "R√©initialiser le mot de passe par email", priority: "important"},
                {id: "AUTH-09", name: "Double authentification (2FA) Admin", description: "Code SMS obligatoire pour admin", priority: "important"},
                {id: "AUTH-10", name: "Refresh Token", description: "Renouveler le token d'acc√®s sans re-connexion", priority: "important"},
                {id: "AUTH-11", name: "D√©connexion", description: "Se d√©connecter et invalider le token", priority: "normal"}
            ],
            "SALARI√â": [
                {id: "SAL-01", name: "Voir mon profil", description: "Consulter mes informations personnelles", priority: "normal"},
                {id: "SAL-02", name: "Modifier mon profil", description: "Mettre √† jour nom, t√©l√©phone, adresse", priority: "important"},
                {id: "SAL-03", name: "Modifier pr√©f√©rences de livraison", description: "Choisir jours, cr√©neaux horaires, adresse", priority: "important"},
                {id: "SAL-04", name: "Consulter le catalogue produits", description: "Voir tous les produits avec filtres", priority: "critical"},
                {id: "SAL-05", name: "Rechercher un produit", description: "Recherche par nom, cat√©gorie, marque", priority: "critical"},
                {id: "SAL-06", name: "Voir d√©tail d'un produit", description: "Consulter description, prix, stock disponible", priority: "critical"},
                {id: "SAL-07", name: "Ajouter produit au panier", description: "S√©lectionner quantit√© et ajouter au panier", priority: "critical"},
                {id: "SAL-08", name: "Voir mon panier", description: "Consulter produits ajout√©s avec total", priority: "critical"},
                {id: "SAL-09", name: "Modifier quantit√© dans le panier", description: "Augmenter/diminuer quantit√© d'un produit", priority: "critical"},
                {id: "SAL-10", name: "Supprimer produit du panier", description: "Retirer un produit du panier", priority: "critical"},
                {id: "SAL-11", name: "Appliquer un coupon de r√©duction", description: "Saisir code promo pour obtenir r√©duction", priority: "important"},
                {id: "SAL-12", name: "Choisir fr√©quence de livraison", description: "S√©lectionner hebdomadaire/bimensuelle/mensuelle", priority: "critical"},
                {id: "SAL-13", name: "Valider ma commande", description: "Confirmer le panier et passer commande", priority: "critical"},
                {id: "SAL-14", name: "Payer par Mobile Money", description: "Payer avec Orange Money/Wave/MTN", priority: "critical"},
                {id: "SAL-15", name: "Payer par carte bancaire", description: "Payer avec carte via Stripe/PayPal", priority: "critical"},
                {id: "SAL-16", name: "Voir mes commandes", description: "Consulter historique de toutes mes commandes", priority: "critical"},
                {id: "SAL-17", name: "Voir d√©tail d'une commande", description: "Consulter produits, montant, statut, livraison", priority: "critical"},
                {id: "SAL-18", name: "Suivre statut de ma commande", description: "Voir : valid√©e, en pr√©paration, exp√©di√©e, livr√©e", priority: "critical"},
                {id: "SAL-19", name: "Modifier ma commande", description: "Modifier avant pr√©paration", priority: "important"},
                {id: "SAL-20", name: "Annuler ma commande", description: "Annuler si statut = valid√©e ou en attente", priority: "important"},
                {id: "SAL-21", name: "Voir mes coupons disponibles", description: "Liste des coupons actifs utilisables", priority: "normal"},
                {id: "SAL-22", name: "Recevoir notification de livraison", description: "Notification quand commande est livr√©e", priority: "critical"},
                {id: "SAL-23", name: "Consulter historique des paiements", description: "Voir tous mes paiements effectu√©s", priority: "normal"},
                {id: "SAL-24", name: "T√©l√©charger re√ßu de paiement", description: "T√©l√©charger PDF du re√ßu", priority: "important"},
                {id: "SAL-25", name: "Soumettre une r√©clamation", description: "Signaler produit manquant/endommag√©/erreur", priority: "critical"},
                {id: "SAL-26", name: "Suivre ma r√©clamation", description: "Voir statut : en attente, en cours, r√©solue", priority: "important"},
                {id: "SAL-27", name: "Demander un retour produit", description: "Demander retour suite √† r√©clamation", priority: "important"}
            ],
            "COMMERCIAL": [
                {id: "COM-01", name: "Voir mon tableau de bord", description: "Vue d'ensemble : prospects, entreprises, ventes", priority: "critical"},
                {id: "COM-02", name: "Ajouter une entreprise prospect√©e", description: "Cr√©er fiche entreprise", priority: "critical"},
                {id: "COM-03", name: "Voir liste des prospects", description: "Consulter toutes les entreprises d√©march√©es", priority: "critical"},
                {id: "COM-04", name: "Mettre √† jour statut prospect", description: "Changer : en attente, int√©ress√©e, partenaire, refus√©e", priority: "critical"},
                {id: "COM-05", name: "Voir liste des entreprises partenaires", description: "Liste des entreprises ayant sign√©", priority: "critical"},
                {id: "COM-06", name: "Inscrire un salari√©", description: "Cr√©er compte salari√© et l'associer √† une entreprise", priority: "critical"},
                {id: "COM-07", name: "Voir liste des salari√©s inscrits", description: "Par entreprise avec statut", priority: "important"},
                {id: "COM-08", name: "Cr√©er un coupon de r√©duction", description: "Code promo avec date validit√©", priority: "critical"},
                {id: "COM-09", name: "Voir mes coupons cr√©√©s", description: "Liste de tous les coupons avec utilisation", priority: "important"},
                {id: "COM-10", name: "Modifier un coupon", description: "Changer dates ou produits √©ligibles", priority: "normal"},
                {id: "COM-11", name: "D√©sactiver un coupon", description: "Rendre un coupon inutilisable", priority: "normal"},
                {id: "COM-12", name: "Voir statistiques par entreprise", description: "Nombre commandes, montant total", priority: "critical"},
                {id: "COM-13", name: "Exporter rapport de ventes", description: "T√©l√©charger Excel/PDF des statistiques", priority: "important"},
                {id: "COM-14", name: "Voir graphique √©volution ventes", description: "Graphique mensuel/trimestriel", priority: "normal"}
            ],
            "LOGISTIQUE": [
                {id: "LOG-01", name: "Voir tableau de bord logistique", description: "Vue : commandes √† pr√©parer, stocks, livraisons", priority: "critical"},
                {id: "LOG-02", name: "Voir commandes √† pr√©parer", description: "Liste des commandes valid√©es en attente", priority: "critical"},
                {id: "LOG-03", name: "Filtrer commandes par date/zone", description: "Filtrer par date livraison ou zone", priority: "critical"},
                {id: "LOG-04", name: "Marquer commande en pr√©paration", description: "Changer statut", priority: "critical"},
                {id: "LOG-05", name: "G√©n√©rer bon de pr√©paration", description: "PDF avec liste produits", priority: "critical"},
                {id: "LOG-06", name: "G√©n√©rer bon de pr√©paration group√©", description: "PDF regroupant plusieurs commandes", priority: "important"},
                {id: "LOG-07", name: "Voir √©tat des stocks", description: "Liste produits avec quantit√© disponible", priority: "critical"},
                {id: "LOG-08", name: "Recevoir alerte stock bas", description: "Notification quand stock < seuil", priority: "critical"},
                {id: "LOG-09", name: "Voir historique mouvements stock", description: "Entr√©es/sorties avec dates", priority: "important"},
                {id: "LOG-10", name: "Voir liste des fournisseurs", description: "Tous les fournisseurs avec contacts", priority: "important"},
                {id: "LOG-11", name: "Passer commande fournisseur", description: "Cr√©er commande d'approvisionnement", priority: "critical"},
                {id: "LOG-12", name: "Voir commandes fournisseurs", description: "Liste avec statut", priority: "important"},
                {id: "LOG-13", name: "Confirmer r√©ception fournisseur", description: "Valider r√©ception et mettre √† jour stock", priority: "critical"},
                {id: "LOG-14", name: "Signaler √©cart quantit√© re√ßue", description: "Si quantit√© re√ßue ‚â† quantit√© command√©e", priority: "important"},
                {id: "LOG-15", name: "Planifier tourn√©e de livraison", description: "Cr√©er tourn√©e avec zone, date, livreur", priority: "critical"},
                {id: "LOG-16", name: "Assigner commandes √† une tourn√©e", description: "Ajouter commandes √† une tourn√©e", priority: "critical"},
                {id: "LOG-17", name: "Optimiser itin√©raire de tourn√©e", description: "Calculer meilleur ordre de livraison", priority: "important"},
                {id: "LOG-18", name: "Voir toutes les tourn√©es", description: "Liste avec statut", priority: "critical"},
                {id: "LOG-19", name: "G√©rer les retours produits", description: "Voir demandes de retour et les valider", priority: "important"},
                {id: "LOG-20", name: "Traiter un retour", description: "Inspecter produit et choisir action", priority: "important"},
                {id: "LOG-21", name: "Rembourser un salari√©", description: "D√©clencher remboursement", priority: "critical"}
            ],
            "LIVREUR": [
                {id: "LIV-01", name: "Voir mon tableau de bord", description: "Vue : tourn√©es du jour, livraisons effectu√©es", priority: "critical"},
                {id: "LIV-02", name: "Voir mes tourn√©es", description: "Liste des tourn√©es assign√©es", priority: "critical"},
                {id: "LIV-03", name: "Voir d√©tail d'une tourn√©e", description: "Liste ordonn√©e des livraisons", priority: "critical"},
                {id: "LIV-04", name: "Voir itin√©raire sur carte", description: "Carte avec toutes les adresses", priority: "important"},
                {id: "LIV-05", name: "D√©marrer une tourn√©e", description: "Marquer tourn√©e comme en cours", priority: "critical"},
                {id: "LIV-06", name: "Voir adresse de livraison", description: "Adresse compl√®te + t√©l√©phone client", priority: "critical"},
                {id: "LIV-07", name: "Scanner QR code", description: "Valider livraison en scannant QR", priority: "critical"},
                {id: "LIV-08", name: "Marquer livraison effectu√©e", description: "Sans QR : bouton Livr√©", priority: "critical"},
                {id: "LIV-09", name: "Signaler probl√®me de livraison", description: "Client absent, adresse incorrecte", priority: "critical"},
                {id: "LIV-10", name: "Terminer une tourn√©e", description: "Marquer tourn√©e termin√©e", priority: "critical"},
                {id: "LIV-11", name: "Voir historique de mes livraisons", description: "Toutes les livraisons pass√©es", priority: "normal"},
                {id: "LIV-12", name: "Modifier mes disponibilit√©s", description: "Jours/cr√©neaux disponibles", priority: "important"}
            ],
            "ADMINISTRATEUR": [
                {id: "ADM-01", name: "Voir tableau de bord global", description: "Vue compl√®te syst√®me", priority: "critical"},
                {id: "ADM-02", name: "Voir tous les utilisateurs", description: "Liste de tous les comptes", priority: "critical"},
                {id: "ADM-03", name: "Cr√©er un utilisateur", description: "Cr√©er compte pour n'importe quel r√¥le", priority: "important"},
                {id: "ADM-04", name: "Modifier un utilisateur", description: "Changer r√¥le, informations", priority: "important"},
                {id: "ADM-05", name: "D√©sactiver/Activer un compte", description: "Bloquer ou d√©bloquer un utilisateur", priority: "critical"},
                {id: "ADM-06", name: "Supprimer un utilisateur", description: "Suppression d√©finitive", priority: "important"},
                {id: "ADM-07", name: "Voir tous les produits", description: "Catalogue complet avec stocks", priority: "critical"},
                {id: "ADM-08", name: "Ajouter un produit", description: "Cr√©er nouveau produit", priority: "critical"},
                {id: "ADM-09", name: "Modifier un produit", description: "Changer prix, description, stock", priority: "critical"},
                {id: "ADM-10", name: "D√©sactiver un produit", description: "Rendre produit non commandable", priority: "important"},
                {id: "ADM-11", name: "Supprimer un produit", description: "Suppression d√©finitive", priority: "normal"},
                {id: "ADM-12", name: "Voir toutes les commandes", description: "Liste compl√®te avec filtres", priority: "critical"},
                {id: "ADM-13", name: "Modifier statut d'une commande", description: "Forcer changement de statut", priority: "important"},
                {id: "ADM-14", name: "Annuler une commande", description: "Annuler n'importe quelle commande", priority: "important"},
                {id: "ADM-15", name: "Voir tous les paiements", description: "Liste compl√®te avec statuts", priority: "critical"},
                {id: "ADM-16", name: "Voir paiements √©chou√©s", description: "Filtrer uniquement les √©checs", priority: "important"},
                {id: "ADM-17", name: "Traiter remboursement", description: "Forcer remboursement manuel", priority: "important"},
                {id: "ADM-18", name: "Voir toutes les livraisons", description: "Toutes tourn√©es et livraisons", priority: "important"},
                {id: "ADM-19", name: "Voir r√©clamations", description: "Toutes les r√©clamations", priority: "important"},
                {id: "ADM-20", name: "Voir statistiques globales", description: "KPIs : CA, nb commandes", priority: "critical"},
                {id: "ADM-21", name: "Exporter donn√©es", description: "Export Excel/CSV", priority: "normal"},
                {id: "ADM-22", name: "Voir logs syst√®me", description: "Historique des actions", priority: "important"},
                {id: "ADM-23", name: "Configurer param√®tres syst√®me", description: "G√©rer configurations globales", priority: "normal"}
            ]
        };

        let features = {};
        let progressData = [0];
        let history = [];
        let chart;
        let editingFeatureId = null;

        function showStatus(message, type = 'success') {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.style.background = type === 'success' ? '#a8d5a8' : '#e8b4b4';
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        async function loadData() {
            // Essai 1 : window.storage (stockage persistant Claude)
            try {
                const result = await window.storage.get('coopachat_features');
                if (result && result.value) {
                    const data = JSON.parse(result.value);
                    features = data.features || JSON.parse(JSON.stringify(DEFAULT_FEATURES));
                    progressData = data.progressData || [0];
                    history = data.history || [];
                    console.log('‚úÖ Donn√©es charg√©es depuis window.storage');
                    showStatus('‚úÖ Donn√©es charg√©es');
                    renderModules();
                    updateUI();
                    return;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è window.storage non disponible:', error);
            }

            // Essai 2 : localStorage (stockage navigateur)
            try {
                const localData = localStorage.getItem('coopachat_features');
                if (localData) {
                    const data = JSON.parse(localData);
                    features = data.features || JSON.parse(JSON.stringify(DEFAULT_FEATURES));
                    progressData = data.progressData || [0];
                    history = data.history || [];
                    console.log('‚úÖ Donn√©es charg√©es depuis localStorage');
                    showStatus('‚úÖ Donn√©es charg√©es (local)');
                    renderModules();
                    updateUI();
                    return;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è localStorage non disponible:', error);
            }

            // Initialisation par d√©faut
            console.log('üì¶ Initialisation avec donn√©es par d√©faut');
            features = JSON.parse(JSON.stringify(DEFAULT_FEATURES));
            progressData = [0];
            history = [];
            await saveData();
            renderModules();
            updateUI();
        }

        async function saveData() {
            const dataToSave = {
                features,
                progressData,
                history,
                lastSaved: new Date().toISOString()
            };
            const jsonData = JSON.stringify(dataToSave);
            
            let savedToCloud = false;
            let savedToLocal = false;

            // Sauvegarde 1 : window.storage (prioritaire)
            try {
                const result = await window.storage.set('coopachat_features', jsonData);
                if (result) {
                    savedToCloud = true;
                    console.log('üíæ Sauvegard√© dans window.storage');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è √âchec window.storage:', error);
            }

            // Sauvegarde 2 : localStorage (backup)
            try {
                localStorage.setItem('coopachat_features', jsonData);
                savedToLocal = true;
                console.log('üíæ Sauvegard√© dans localStorage');
            } catch (error) {
                console.warn('‚ö†Ô∏è √âchec localStorage:', error);
            }

            // Notification √† l'utilisateur
            if (savedToCloud && savedToLocal) {
                showStatus('üíæ Sauvegard√© (cloud + local)');
                return true;
            } else if (savedToCloud) {
                showStatus('üíæ Sauvegard√© (cloud)');
                return true;
            } else if (savedToLocal) {
                showStatus('üíæ Sauvegard√© (local uniquement)');
                return true;
            } else {
                showStatus('‚ö†Ô∏è √âchec sauvegarde', 'error');
                alert('‚ö†Ô∏è ATTENTION : La sauvegarde a √©chou√©. Vos donn√©es risquent d\'√™tre perdues au rechargement. Copiez vos donn√©es importantes !');
                return false;
            }
        }

        function getTotalFeatures() {
            let total = 0;
            for (let module in features) {
                total += features[module].length;
            }
            return total;
        }

        function getCompletedFeatures() {
            let completed = 0;
            for (let module in features) {
                features[module].forEach(f => {
                    if (f.completed) completed++;
                });
            }
            return completed;
        }

        function renderModules() {
            const container = document.getElementById('modulesList');
            container.innerHTML = '';
            
            const moduleIcons = {
                "AUTHENTIFICATION": "üîê",
                "SALARI√â": "üë§",
                "COMMERCIAL": "üíº",
                "LOGISTIQUE": "üì¶",
                "LIVREUR": "üöö",
                "ADMINISTRATEUR": "‚öôÔ∏è"
            };

            for (let moduleName in features) {
                const moduleFeatures = features[moduleName];
                const completedCount = moduleFeatures.filter(f => f.completed).length;
                
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module';
                moduleDiv.innerHTML = `
                    <div class="module-header" onclick="toggleModule(this)">
                        <div class="module-title">
                            <span class="toggle-icon">‚ñº</span>
                            ${moduleIcons[moduleName]} ${moduleName}
                        </div>
                        <div class="module-stats">
                            ${completedCount}/${moduleFeatures.length} compl√©t√©es
                        </div>
                    </div>
                    <div class="features-list">
                        ${moduleFeatures.map(feature => `
                            <div class="feature-item ${feature.completed ? 'completed' : ''}">
                                <input type="checkbox" 
                                       class="feature-checkbox" 
                                       ${feature.completed ? 'checked' : ''}
                                       onchange="toggleFeature('${moduleName}', '${feature.id}')">
                                <div class="feature-id">${feature.id}</div>
                                <div class="feature-name">${feature.name}</div>
                                <div class="feature-priority priority-${feature.priority}">
                                    ${feature.priority === 'critical' ? 'üî¥ Critique' : 
                                      feature.priority === 'important' ? 'üü° Important' : 'üü¢ Normal'}
                                </div>
                                <div class="feature-actions">
                                    <button class="btn-icon btn-edit" onclick="editFeature('${moduleName}', '${feature.id}')">‚úèÔ∏è</button>
                                    <button class="btn-icon btn-delete" onclick="deleteFeature('${moduleName}', '${feature.id}')">üóëÔ∏è</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(moduleDiv);
            }
        }

        function toggleModule(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        async function toggleFeature(moduleName, featureId) {
            const feature = features[moduleName].find(f => f.id === featureId);
            if (feature) {
                feature.completed = !feature.completed;
                
                const completed = getCompletedFeatures();
                progressData.push(completed);
                
                const total = getTotalFeatures();
                const remaining = total - completed;
                const hoursRemaining = remaining * 2;
                const daysRemaining = Math.ceil(hoursRemaining / 8);
                
                history.unshift({
                    action: feature.completed ? `‚úÖ ${feature.name}` : `‚¨ú ${feature.name}`,
                    date: new Date().toLocaleString('fr-FR'),
                    total: completed,
                    daysLeft: daysRemaining
                });
                
                if (history.length > 10) history.pop();
                
                renderModules();
                updateUI();
                const saved = await saveData();
                
                if (!saved) {
                    console.warn('‚ö†Ô∏è La sauvegarde a √©chou√©, tentative de restauration...');
                    feature.completed = !feature.completed;
                    renderModules();
                    updateUI();
                }
                
                if (completed === total) {
                    celebrate();
                }
            }
        }

        function openAddModal() {
            editingFeatureId = null;
            document.getElementById('modalTitle').textContent = 'Ajouter une fonctionnalit√©';
            document.getElementById('featureForm').reset();
            document.getElementById('featureModal').classList.add('active');    
        }

        function editFeature(moduleName, featureId) {
            const feature = features[moduleName].find(f => f.id === featureId);
            if (feature) {
                editingFeatureId = {moduleName, featureId};
                document.getElementById('modalTitle').textContent = 'Modifier la fonctionnalit√©';
                document.getElementById('featureModule').value = moduleName;
                document.getElementById('featureId').value = feature.id;
                document.getElementById('featureName').value = feature.name;
                document.getElementById('featureDescription').value = feature.description || '';
                document.getElementById('featurePriority').value = feature.priority;
                document.getElementById('featureModal').classList.add('active');
            }
        }

        async function deleteFeature(moduleName, featureId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette fonctionnalit√© ?')) {
                features[moduleName] = features[moduleName].filter(f => f.id !== featureId);
                renderModules();
                updateUI();
                await saveData();
            }
        }

        function closeModal() {
            document.getElementById('featureModal').classList.remove('active');
        }

        document.getElementById('featureForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const moduleName = document.getElementById('featureModule').value;
            const featureData = {
                id: document.getElementById('featureId').value,
                name: document.getElementById('featureName').value,
                description: document.getElementById('featureDescription').value,
                priority: document.getElementById('featurePriority').value,
                completed: false
            };

            if (editingFeatureId) {
                const oldModule = editingFeatureId.moduleName;
                const oldId = editingFeatureId.featureId;
                
                if (oldModule === moduleName) {
                    const index = features[moduleName].findIndex(f => f.id === oldId);
                    if (index !== -1) {
                        featureData.completed = features[moduleName][index].completed;
                        features[moduleName][index] = featureData;
                    }
                } else {
                    features[oldModule] = features[oldModule].filter(f => f.id !== oldId);
                    features[moduleName].push(featureData);
                }
            } else {
                if (!features[moduleName]) features[moduleName] = [];
                features[moduleName].push(featureData);
            }

            renderModules();
            updateUI();
            await saveData();
            closeModal();
        });

        function initChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: progressData.map((_, i) => i === 0 ? 'D√©but' : `√âtape ${i}`),
                    datasets: [{
                        label: 'Fonctionnalit√©s termin√©es',
                        data: progressData,
                        borderColor: '#e8b4d0',
                        backgroundColor: 'rgba(232, 180, 208, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#e8b4d0',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: '√âvolution de votre progression',
                            font: { size: 18 },
                            color: '#e8b4d0'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: getTotalFeatures(),
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
        }

        function updateUI() {
            const completed = getCompletedFeatures();
            const total = getTotalFeatures();
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('completed').textContent = completed;
            document.getElementById('remaining').textContent = total - completed;
            document.getElementById('percentage').textContent = percentage + '%';
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
            
            const remaining = total - completed;
            const hoursRemaining = remaining * 2;
            const daysRemaining = Math.ceil(hoursRemaining / 8);
            document.getElementById('days-left').textContent = daysRemaining;
            
            chart.data.labels = progressData.map((_, i) => i === 0 ? 'D√©but' : `√âtape ${i}`);
            chart.data.datasets[0].data = progressData;
            chart.options.scales.y.max = total;
            chart.update();
            
            const historyList = document.getElementById('historyList');
            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999;">Aucune modification pour le moment</p>';
            } else {
                historyList.innerHTML = history.map(item => `
                    <div class="history-item">
                        <span><strong>${item.action}</strong> - ${item.date}</span>
                        <span style="display: flex; gap: 15px; align-items: center;">
                            <span style="color: #e8b4d0; font-weight: bold;">${item.total}/${total}</span>
                            <span style="color: #a8c8e0; font-size: 0.9em;">‚è≥ ${item.daysLeft} jours</span>
                        </span>
                    </div>
                `).join('');
            }
        }

        function celebrate() {
            const colors = ['#e8b4d0', '#a8c8e0', '#a8d5a8', '#f0d890', '#d4b8a8'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * window.innerWidth + 'px';
                confetti.style.top = '-10px';
                confetti.style.borderRadius = '50%';
                confetti.style.zIndex = '9999';
                document.body.appendChild(confetti);
                
                const duration = Math.random() * 3 + 2;
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                }).onfinish = () => confetti.remove();
            }
            
            alert('üéâ F√©licitations ! Vous avez termin√© toutes les fonctionnalit√©s ! üéâ');
        }

        initChart();
        loadData();
    </script>
</body>
</html>
